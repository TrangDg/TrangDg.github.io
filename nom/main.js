var data = [
    {
        "data": {
            "id": "nom:label-00002",
            "label": "nom:label-00002\nskosxl:Label\nschema:CreativeWork",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l0",
            "label": "\"040903003\"",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:image-1",
            "label": "nom:image-1\nschema:ImageObject",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l1",
            "label": "\"1\"^^xsd:integer",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:label-00001",
            "label": "nom:label-00001\nskosxl:Label\nschema:CreativeWork",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l2",
            "label": "\"040601005\"",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:definition-1",
            "label": "nom:definition-1\nschema:CreativeWork",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "nom:source-1",
            "label": "nom:source-1\nschema:Thing",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "nom:source-2",
            "label": "nom:source-2\nschema:Thing",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l4",
            "label": "\"Wikimedia Commons\"@fr",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:14960",
            "label": "nom:14960\nschema:CreativeWork\nskos:Concept",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l5",
            "label": "\"May also use \\\"Package, Product\\\".\"@en",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:contributor-1",
            "label": "nom:contributor-1\nschema:Thing",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l7",
            "label": "\"Briquette\"@fr",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:image-org-1",
            "label": "nom:image-org-1\nschema:ImageObject",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "<https://app.pch.gc.ca/public_info/nomenclature/images/11695_20210401181000.jpg>",
            "label": "<https://app.pch.gc.ca/public_info/nomenclature/images/11695_20210401181000.jpg>",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "nom:label-00003",
            "label": "nom:label-00003\nskosxl:Label\nschema:CreativeWork",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "lexinfo:feminine",
            "label": "lexinfo:feminine",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l12",
            "label": "\"2020-01-21T15:25:37.116000+00:00\"^^xsd:dateTime",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:definition-2",
            "label": "nom:definition-2\nschema:CreativeWork",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l13",
            "label": "\"Petite boîte plastifiée en carton, doublée de film d'aluminium, emballée avec une paille en plastique qui peut être insérée à travers un trou sur le dessus de la boîte. Sert à transporter et à consommer des jus de fruits, de légumes, etc.\"@fr",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l15",
            "label": "\"Nomenclature pour le catalogage des objets de musée\"@fr",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l17",
            "label": "\"02-00147\"",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l18",
            "label": "\"Drink Box\"@en",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "<https://nomenclature.info/nom/>",
            "label": "<https://nomenclature.info/nom/>",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l21",
            "label": "\"2021-11-15T19:17:34.919000+00:00\"^^xsd:dateTime",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "<http://d-nb.info/gnd/4058247-4>",
            "label": "<http://d-nb.info/gnd/4058247-4>",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "nom:label-00004",
            "label": "nom:label-00004\nskosxl:Label\nschema:CreativeWork",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l23",
            "label": "\"Box, Drink\"@en",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "<https://www.zotero.org/groups/2375389/ctfn__gtcn/items/itemKey/8WCZX8ZE>",
            "label": "<https://www.zotero.org/groups/2375389/ctfn__gtcn/items/itemKey/8WCZX8ZE>",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "nom:contributor-2",
            "label": "nom:contributor-2\nschema:Thing",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l25",
            "label": "\"Canadian Heritage Information Network (CHIN)\"@en",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l26",
            "label": "\"Réseau canadien d’information sur le patrimoine (RCIP)\"@fr",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l27",
            "label": "\"On peut aussi employer \\\"Emballage de produit\\\".\"@fr",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:4756",
            "label": "nom:4756",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l31",
            "label": "\"14960\"",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l32",
            "label": "\"inv\"",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "<https://commons.wikimedia.org/wiki/File:NSRW_Dirigible_Balloon.png>",
            "label": "<https://commons.wikimedia.org/wiki/File:NSRW_Dirigible_Balloon.png>",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l38",
            "label": "\"A small plasticized cardboard box, lined with aluminum foil, packaged with a plastic straw that can be inserted through a foil-covered hole in the top. Used to carry and consume drinks, generally juice.\"@en",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l39",
            "label": "\"American Association for State and Local History (AASLH)\"@fr",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l40",
            "label": "\"Boîte à boire\"@fr-ca",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l42",
            "label": "\"American Association for State and Local History (AASLH)\"@en",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:label-00005",
            "label": "nom:label-00005\nskosxl:Label\nschema:CreativeWork",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "l44",
            "label": "\"box, drinking\"@en",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l45",
            "label": "\"Nomenclature for Museum Cataloging\"@en",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l47",
            "label": "\"040601005\"",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l48",
            "label": "\"Wikimedia Commons\"@en",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "l49",
            "label": "\"4\"^^xsd:integer",
            "color": "#cccccc"
        }
    },
    {
        "data": {
            "id": "nom:1091",
            "label": "nom:1091",
            "color": "#b3e6ff"
        }
    },
    {
        "data": {
            "id": "e0",
            "source": "nom:label-00002",
            "target": "l0",
            "label": "schema:position"
        }
    },
    {
        "data": {
            "id": "e1",
            "source": "nom:image-1",
            "target": "l1",
            "label": "schema:position"
        }
    },
    {
        "data": {
            "id": "e2",
            "source": "nom:label-00001",
            "target": "l2",
            "label": "schema:position"
        }
    },
    {
        "data": {
            "id": "e3",
            "source": "nom:definition-1",
            "target": "nom:source-1",
            "label": "dct:source"
        }
    },
    {
        "data": {
            "id": "e4",
            "source": "nom:source-2",
            "target": "l4",
            "label": "schema:name"
        }
    },
    {
        "data": {
            "id": "e5",
            "source": "nom:14960",
            "target": "l5",
            "label": "skos:scopeNote"
        }
    },
    {
        "data": {
            "id": "e6",
            "source": "nom:label-00001",
            "target": "nom:contributor-1",
            "label": "dct:contributor"
        }
    },
    {
        "data": {
            "id": "e7",
            "source": "nom:label-00002",
            "target": "l7",
            "label": "skosxl:LiteralForm"
        }
    },
    {
        "data": {
            "id": "e8",
            "source": "nom:image-1",
            "target": "nom:image-org-1",
            "label": "schema:citation"
        }
    },
    {
        "data": {
            "id": "e9",
            "source": "nom:image-1",
            "target": "<https://app.pch.gc.ca/public_info/nomenclature/images/11695_20210401181000.jpg>",
            "label": "schema:contentUrl"
        }
    },
    {
        "data": {
            "id": "e10",
            "source": "nom:label-00003",
            "target": "lexinfo:feminine",
            "label": "lexinfo:gender"
        }
    },
    {
        "data": {
            "id": "e11",
            "source": "nom:label-00002",
            "target": "lexinfo:feminine",
            "label": "lexinfo:gender"
        }
    },
    {
        "data": {
            "id": "e12",
            "source": "nom:14960",
            "target": "l12",
            "label": "dct:created"
        }
    },
    {
        "data": {
            "id": "e13",
            "source": "nom:definition-2",
            "target": "l13",
            "label": "schema:text"
        }
    },
    {
        "data": {
            "id": "e14",
            "source": "nom:14960",
            "target": "nom:image-1",
            "label": "schema:image"
        }
    },
    {
        "data": {
            "id": "e15",
            "source": "nom:source-1",
            "target": "l15",
            "label": "schema:name"
        }
    },
    {
        "data": {
            "id": "e16",
            "source": "nom:14960",
            "target": "nom:label-00003",
            "label": "skosxl:prefLabel"
        }
    },
    {
        "data": {
            "id": "e17",
            "source": "nom:14960",
            "target": "l17",
            "label": "skos:notation"
        }
    },
    {
        "data": {
            "id": "e18",
            "source": "nom:label-00001",
            "target": "l18",
            "label": "skosxl:LiteralForm"
        }
    },
    {
        "data": {
            "id": "e19",
            "source": "nom:definition-2",
            "target": "nom:source-1",
            "label": "dct:source"
        }
    },
    {
        "data": {
            "id": "e20",
            "source": "nom:14960",
            "target": "<https://nomenclature.info/nom/>",
            "label": "skos:inScheme"
        }
    },
    {
        "data": {
            "id": "e21",
            "source": "nom:14960",
            "target": "l21",
            "label": "dct:modified"
        }
    },
    {
        "data": {
            "id": "e22",
            "source": "nom:14960",
            "target": "<http://d-nb.info/gnd/4058247-4>",
            "label": "skos:exactMatch"
        }
    },
    {
        "data": {
            "id": "e23",
            "source": "nom:label-00004",
            "target": "l23",
            "label": "skosxl:LiteralForm"
        }
    },
    {
        "data": {
            "id": "e24",
            "source": "nom:14960",
            "target": "<https://www.zotero.org/groups/2375389/ctfn__gtcn/items/itemKey/8WCZX8ZE>",
            "label": "dct:source"
        }
    },
    {
        "data": {
            "id": "e25",
            "source": "nom:contributor-2",
            "target": "l25",
            "label": "schema:name"
        }
    },
    {
        "data": {
            "id": "e26",
            "source": "nom:contributor-2",
            "target": "l26",
            "label": "schema:name"
        }
    },
    {
        "data": {
            "id": "e27",
            "source": "nom:14960",
            "target": "l27",
            "label": "skos:scopeNote"
        }
    },
    {
        "data": {
            "id": "e28",
            "source": "nom:label-00003",
            "target": "nom:contributor-2",
            "label": "dct:contributor"
        }
    },
    {
        "data": {
            "id": "e29",
            "source": "nom:label-00002",
            "target": "nom:contributor-2",
            "label": "dct:contributor"
        }
    },
    {
        "data": {
            "id": "e30",
            "source": "nom:14960",
            "target": "nom:4756",
            "label": "skos:broader"
        }
    },
    {
        "data": {
            "id": "e31",
            "source": "nom:14960",
            "target": "l31",
            "label": "dct:identifier"
        }
    },
    {
        "data": {
            "id": "e32",
            "source": "nom:label-00004",
            "target": "l32",
            "label": "schema:keywords"
        }
    },
    {
        "data": {
            "id": "e33",
            "source": "nom:14960",
            "target": "nom:definition-2",
            "label": "skos:definition"
        }
    },
    {
        "data": {
            "id": "e34",
            "source": "nom:label-00003",
            "target": "nom:source-1",
            "label": "dct:source"
        }
    },
    {
        "data": {
            "id": "e35",
            "source": "nom:label-00002",
            "target": "nom:source-1",
            "label": "dct:source"
        }
    },
    {
        "data": {
            "id": "e36",
            "source": "nom:image-org-1",
            "target": "<https://commons.wikimedia.org/wiki/File:NSRW_Dirigible_Balloon.png>",
            "label": "schema:contentUrl"
        }
    },
    {
        "data": {
            "id": "e37",
            "source": "nom:14960",
            "target": "nom:label-00004",
            "label": "skosxl:altLabel"
        }
    },
    {
        "data": {
            "id": "e38",
            "source": "nom:definition-1",
            "target": "l38",
            "label": "schema:text"
        }
    },
    {
        "data": {
            "id": "e39",
            "source": "nom:contributor-1",
            "target": "l39",
            "label": "schema:name"
        }
    },
    {
        "data": {
            "id": "e40",
            "source": "nom:label-00003",
            "target": "l40",
            "label": "skosxl:LiteralForm"
        }
    },
    {
        "data": {
            "id": "e41",
            "source": "nom:label-00001",
            "target": "nom:source-1",
            "label": "dct:source"
        }
    },
    {
        "data": {
            "id": "e42",
            "source": "nom:contributor-1",
            "target": "l42",
            "label": "schema:name"
        }
    },
    {
        "data": {
            "id": "e43",
            "source": "nom:14960",
            "target": "nom:label-00002",
            "label": "skosxl:prefLabel"
        }
    },
    {
        "data": {
            "id": "e44",
            "source": "nom:label-00005",
            "target": "l44",
            "label": "skosxl:LiteralForm"
        }
    },
    {
        "data": {
            "id": "e45",
            "source": "nom:source-1",
            "target": "l45",
            "label": "schema:name"
        }
    },
    {
        "data": {
            "id": "e46",
            "source": "nom:14960",
            "target": "nom:label-00001",
            "label": "skosxl:prefLabel"
        }
    },
    {
        "data": {
            "id": "e47",
            "source": "nom:label-00004",
            "target": "l47",
            "label": "schema:position"
        }
    },
    {
        "data": {
            "id": "e48",
            "source": "nom:source-2",
            "target": "l48",
            "label": "schema:name"
        }
    },
    {
        "data": {
            "id": "e49",
            "source": "nom:14960",
            "target": "l49",
            "label": "schema:position"
        }
    },
    {
        "data": {
            "id": "e50",
            "source": "nom:14960",
            "target": "nom:definition-1",
            "label": "skos:definition"
        }
    },
    {
        "data": {
            "id": "e51",
            "source": "nom:image-org-1",
            "target": "nom:source-2",
            "label": "dct:source"
        }
    },
    {
        "data": {
            "id": "e52",
            "source": "nom:14960",
            "target": "nom:label-00005",
            "label": "skosxl:hiddenLabel"
        }
    },
    {
        "data": {
            "id": "e53",
            "source": "nom:14960",
            "target": "nom:1091",
            "label": "skos:narrower"
        }
    }
]

   var cy = cytoscape({
        container: document.getElementById('cy'),
        elements: data,

        // layout: {
        //     name: 'cola',
        //     infinite: true,
        //     fit: false,
        //     nodeDimensionsIncludeLabels: true,
        //     maxSimulationTime: 500,
        //     // nodeSpacing: function( node ){ return 30; }
        //   },

        layout: {
          name: 'dagre',
          rankDir: 'LR',
          rankSep: 200,
          // edgeSep: 200,
          nodeSep: 100,
          // ranker: 'longest-path',
          },

        style: [
          {
            selector: 'node',
            style: {
             'width': 'label',
             'height': 'label',
                'shape': 'round-rectangle',
                'background-color': 'data(color)',
                'label': 'data(label)',
                'text-valign': 'center',
                'text-halign': 'center',
                'text-wrap': 'wrap',
                'border-color' : 'black',
                'border-width': 1,
                'padding': 5
            }
          },
          {
            selector: 'edge',
            style: {
               label: 'data(label)',
               'target-arrow-shape': 'triangle',
               'curve-style': 'bezier',
               'text-background-color': '#f0f0f0',
               'text-background-opacity': 1
            }
          },
          // {
          //   selector: 'node.highlight',
          //   style: {
          //       width: 'label',
          //       height: 'label',
          //       padding: 5,
          //       shape: 'round-rectangle',
          //       // 'background-color': 'data(color)',
          //       label: 'data(label)',
          //       'text-valign': 'center',
          //       'text-halign': 'center',
          //       'text-wrap': 'wrap',
          //       // 'text-max-width': 80
          //   }
          // },
          // {
          //   selector: 'node.semitransp',
          //   style: {
          //       'background-color': '#D0D0D0',
          //       'opacity': 0.1
          //   }
          // },
          // {
          //   selector: 'edge.highlight',
          //   style: {
          //      label: 'data(label)',
          //      // 'target-arrow-shape': 'triangle',
          //      // 'curve-style': 'bezier',
          //      'line-color': '#303030',
          //      'target-arrow-color': '#303030',
          //      'text-background-color': '#ffffff',
          //      'text-background-opacity': 1,
          //      // 'text-rotation': 'autorotate',
          //      'font-size': 11
          //         // 'edgeLength': 20
          //   }
          // },
          // {
          //   selector: 'edge.semitransp',
          //   style: {
          //      'opacity': 0.1
          //   }
          // }
          ],      
      });

    // cy.unbind('layoutready');
    // cy.bind('layoutready', function() {
    //     cy.fit();
    //     cy.center();
    //   });

    cy.unbind('tap');
    cy.bind('tap', function(e) {
        var sel = e.target;
        if (sel === cy) {
            console.log('canvas is tapped')
            cy.elements().removeClass('semitransp').removeClass('highlight');
            // cy.edges().removeClass('semitransp').removeClass('highlight');
        }
        else if (sel.isNode()) {
            console.log('node is selected')
          var connected = sel.neighborhood();
            cy.elements().difference(connected).not(sel)
                .removeClass('highlight')
                .addClass('semitransp');
            sel.removeClass('semitransp').addClass('highlight');
            connected.removeClass('semitransp').addClass('highlight');
        } else if (sel.isEdge()) {
           var connected = sel.connectedNodes();
            cy.elements().difference(connected).not(sel)
                .removeClass('highlight')
                .addClass('semitransp');
            sel.removeClass('semitransp').addClass('highlight');
            connected.removeClass('semitransp').addClass('highlight');
        } 
        
    });

// var svg = d3.select("svg");

// var width = +svg.attr("width");

// var radius = width / 2;

// var tree = d3.tree()
//     .size([2 * Math.PI, radius])
//     .separation((a, b) => (a.parent == b.parent ? 1 : 2) / a.depth);


// var data = d3.hierarchy(json)
//     .sort((a, b) => d3.ascending(a.data.name, b.data.name));

// const root = tree(data);

// // const svg = d3.create("svg");

// function autoBox() {
//   document.body.appendChild(this);
//   const {x, y, width, height} = this.getBBox();
//   document.body.removeChild(this);
//   return [x, y, width, height];
// };

// // svg.attr("viewBox", autoBox).node();


// svg.append("g")
//     .attr("fill", "none")
//     .attr("stroke", "#555")
//     .attr("stroke-opacity", 0.4)
//     .attr("stroke-width", 1.5)
//   .selectAll("path")
//   .data(root.links())
//   .join("path")
//     .attr("d", d3.linkRadial()
//         .angle(d => d.x)
//         .radius(d => d.y));

// svg.append("g")
//   .selectAll("circle")
//   .data(root.descendants())
//   .join("circle")
//     .attr("transform", d => `
//       rotate(${d.x * 180 / Math.PI - 90})
//       translate(${d.y},0)
//     `)
//     .attr("fill", d => d.children ? "#555" : "#999")
//     .attr("r", 2.5);

// svg.append("g")
//     .attr("font-family", "sans-serif")
//     .attr("font-size", 10)
//     .attr("stroke-linejoin", "round")
//     .attr("stroke-width", 3)
//   .selectAll("text")
//   .data(root.descendants())
//   .join("text")
//     .attr("transform", d => `
//       rotate(${d.x * 180 / Math.PI - 90}) 
//       translate(${d.y},0) 
//       rotate(${d.x >= Math.PI ? 180 : 0})
//     `)
//     .attr("dy", "0.31em")
//     .attr("x", d => d.x < Math.PI === !d.children ? 6 : -6)
//     .attr("text-anchor", d => d.x < Math.PI === !d.children ? "start" : "end")
//     .text(d => d.data.name)
//   .clone(true).lower()
//     .attr("stroke", "white");







// // d3 = require("d3@6")